-- Copyright (C) 2016-2018 Peter Graves <gnooth@gmail.com>

-- This program is free software: you can redistribute it and/or modify
-- it under the terms of the GNU General Public License as published by
-- the Free Software Foundation, either version 3 of the License, or
-- (at your option) any later version.

-- This program is distributed in the hope that it will be useful,
-- but WITHOUT ANY WARRANTY; without even the implied warranty of
-- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-- GNU General Public License for more details.

-- You should have received a copy of the GNU General Public License
-- along with this program.  If not, see <http://www.gnu.org/licenses/>.

using: feline ;
in: feline

: blank?        -- char -> ?
    { 9 10 13 32 } member? ;

{
    "syntax.feline"
    "control.feline"
    "backtrace.feline"
    "dump.feline"
    "sequences.feline"
    "tuple.feline"
    "constant.feline"
    "accept.feline"
    "help.feline"
} [ load-system-file ] each

private

feline-source-directory "disassembler.feline" path-append >constant: disassembler.feline

global: disassembler-file-write-time

: maybe-load-disassembler
    disassembler.feline file-write-time disassembler-file-write-time neq? [
        disassembler.feline [ load ] [ file-write-time !> disassembler-file-write-time ] bi
    ] when ;

public

: d
    maybe-load-disassembler
    "disassembler" use-vocab
    "dis" "disassembler" vocab-find-name [ call-symbol ] when ;

private

feline-home "feral" path-append "editor.feline" path-append >constant: editor.feline

: load-editor
    [
        f load-verbose? set
        editor.feline load
    ] with-dynamic-scope ;

public

: e
    "editor" lookup-vocab [
        use-vocab
    ] [
        drop
        load-editor
        "editor" use-vocab
    ] if
    "edit" "editor" vocab-find-name [ call-symbol ] when ;

: run-tests
    [
        t load-verbose? set

        {
            "test.feline"
            "control-test.feline"
            "random-tests.feline"
            "clisp-tests.feline"
            "stress.feline"
        } [ load-system-file nl nl ] each

        .version

    ] with-dynamic-scope ;
